<html><head><title>Object::Previous</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.03,
  using Pod::Simple::PullParser v2.02,
  under Perl v5.008008 at Fri Apr  2 13:20:42 2010 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<a name='___top' class='dummyTopAnchor' ></a>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>Object::Previous - find the instance of the object that called your function</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SYNOPSIS"
>SYNOPSIS</a></h1>

<pre>    package Human;
    use Object::Previous;

    sub new { bless {hit_points=&#62;(7+int rand 6)} }
    sub hurt_us {
        my $body = shift;
           $body-&#62;{hit_points} -= shift;

        if( (int rand 10) == 0 ) {
            # every once in a while, damaging bodies hurts the sword:

            my $sword = previous_object();
               $sword-&#62;hurt_us(1+int rand 4);
        }
    }

    package Sword;
    sub new { bless {hit_points=&#62;2} }
    sub hurt_human {
        my $sword = shift;
        my $target = shift;

        $target-&#62;hurt_us( 1+int rand 8 );
    }
    sub hurt_us {
        my $sword = shift;
           $sword-&#62;{hit_points} -= shift;

        if( $sword-&#62;{hit_points} &#60;= 0 ) {
            warn &#34;the attacker&#39;s sword broke!&#34;;
        }
    }</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="previous_object"
>previous_object</a></h1>

<p><a href="#previous_object" class="podlinkpod"
>&#34;previous_object&#34;</a> either returns the blessed ref of the caller or <code>undef</code> if it is not possible to find it.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="CAVEATS"
>CAVEATS</a></h1>

<p>If you tinker with the <code>@_</code> in the caller object, <a href="#previous_object" class="podlinkpod"
>&#34;previous_object&#34;</a> won&#39;t work. Curiously, certain ways of tinkering don&#39;t hurt and others do.</p>

<pre>    my $self = shift; # doesn&#39;t hurt previous_object()
    shift while @_;   # doesn&#39;t hurt previous_object()
    splice @_, 0, 30; # doesn&#39;t hurt previous_object()

    unshift @_, &#34;borked&#34;; # breaks previous_object();
    @_ = ();              # breaks previous_object();</pre>

<p>Another caveat is that almost everyone thinks this is a really bad idea and/or bad practice.</p>

<p>The only place I&#39;ve ever seen it actually used in practice is for security in MudOS (LPC, not Perl). LPC has a native previous_object function. It&#39;s used to make sure calling objects are really admin-shells or really the mob they&#39;re supposed to be -- anywhere you wouldn&#39;t want someone to just be able to pass in an appropriate object to subvert the security.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="AUTHOR(S)"
>AUTHOR(S)</a></h1>

<p>Most of the code was ripped from Perl and from <a href="http://perlmonks.org/" class="podlinkurl"
>http://perlmonks.org/</a>, but it was glued together by me.</p>

<p>Paul Miller <code>&#60;jettero@cpan.org&#62;</code></p>

<p>I am using this software in my own projects... If you find bugs, please please please let me know. :) Actually, let me know if you find it handy at all. Half the fun of releasing this stuff is knowing that people use it.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="COPYRIGHT"
>COPYRIGHT</a></h1>

<p>Copyright (c) 2007-2009 Paul Miller</p>

<p>Licensed under the same terms as Perl itself.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SEE_ALSO"
>SEE ALSO</a></h1>

<p>perl(1), <a href="http://search.cpan.org/perldoc?Devel%3A%3AStacktrace" class="podlinkpod"
>Devel::Stacktrace</a>, <a href="http://perlmonks.org/?node_id=690713" class="podlinkurl"
>http://perlmonks.org/?node_id=690713</a>, <a href="http://perlmonks.org/?node_id=690795" class="podlinkurl"
>http://perlmonks.org/?node_id=690795</a>, cop.h, pp_ctl.c</p>

<!-- end doc -->

</body></html>
